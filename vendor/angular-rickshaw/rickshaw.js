"use strict";angular.module("angular-rickshaw",[]).directive("rickshaw",["$compile","$window",function(e,r){return{restrict:"EA",scope:{options:"=rickshawOptions",series:"=rickshawSeries",features:"=rickshawFeatures"},link:function(a,t,i){function s(){p.setSize(),p.render()}function n(e){var r=e.data,a=e.series;return e.series?void a.forEach(function(e){var a=e.key||e.name;if(!a)throw"series needs a key or a name";r.forEach(function(r){var t=r.key||r.name;if(!t)throw"data needs a key or a name";if(a==t){var i=["color","name","data"];i.forEach(function(a){r[a]&&(e[a]=r[a])})}})}):r}function o(){p&&w&&(n({data:a.series,series:w.series}),s())}function c(){if(p){if(a.options){for(var r in a.options)w[r]=a.options[r],console.log(r+"="+a.options[r]);w.element=u[0]}p.configure(w)}else f=angular.element(t),f.append(u),f.empty(),u=e("<div></div>")(a),f.append(u),w=angular.copy(a.options),w.element=u[0],w.series=a.series,p=new Rickshaw.Graph(w);if(a.features){if(a.features.hover){var i={graph:p};i.xFormatter=a.features.hover.xFormatter,i.yFormatter=a.features.hover.yFormatter,i.formatter=a.features.hover.formatter;new Rickshaw.Graph.HoverDetail(i)}if(a.features.palette)for(var n=new Rickshaw.Color.Palette({scheme:a.features.palette}),o=0;o<w.series.length;o++)w.series[o].color=n.color()}if(s(),a.features){if(a.features.xAxis){var c={graph:p};if(a.features.xAxis.timeUnit){var g=new Rickshaw.Fixtures.Time;c.timeUnit=g.unit(a.features.xAxis.timeUnit)}a.features.xAxis.tickFormat&&(c.tickFormat=a.features.xAxis.tickFormat),a.features.xAxis.ticksTreatment&&(c.ticksTreatment=a.features.xAxis.ticksTreatment),l||(l=new Rickshaw.Graph.Axis.X(c),l.render())}if(a.features.yAxis){var k={graph:p};a.features.yAxis.tickFormat&&(k.tickFormat=Rickshaw.Fixtures.Number[a.features.yAxis.tickFormat]),m||(m=new Rickshaw.Graph.Axis.Y(k),m.render())}if(a.features.legend){if(!h){h=e("<div></div>")(a),f.append(h);var d=new Rickshaw.Graph.Legend({graph:p,element:h[0]});if(a.features.legend.toggle){new Rickshaw.Graph.Behavior.Series.Toggle({graph:p,legend:d})}if(a.features.legend.highlight){new Rickshaw.Graph.Behavior.Series.Highlight({graph:p,legend:d})}}}else h&&(h.remove(),h=null)}}var f,u,h,l,m,p,w,g=a.$watch("options",function(e,r){angular.equals(e,r)||c()},!0),k=a.$watchCollection("series",function(e,r){angular.equals(e,r)||o()},!0),d=a.$watch("features",function(e,r){angular.equals(e,r)||c()},!0);a.$on("$destroy",function(){g(),k(),d()}),angular.element(r).on("resize",function(){a.$broadcast("rickshaw::resize")}),a.$on("rickshaw::resize",function(){s()}),c()},controller:["$scope","$element","$attrs",function(e,r,a){}]}}]);